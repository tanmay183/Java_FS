
### âœ… **6. ResultSet Handling**

#### ðŸ”¸ **What is `ResultSet`?**

A `ResultSet` is a table of data representing a database result set, which is generated by executing a query like `SELECT`.

#### ðŸ”¹ **Common Methods**

| Method              | Description                               |
| ------------------- | ----------------------------------------- |
| `rs.next()`         | Moves the cursor to the next row          |
| `rs.getString(col)` | Gets a column's value as `String`         |
| `rs.getInt(col)`    | Gets a column's value as `int`            |
| `rs.wasNull()`      | Checks if last column read was SQL `NULL` |
| `rs.getObject(col)` | Safely gets column regardless of type     |

---

#### ðŸ”¸ **Example Code for `ResultSet` Handling**

```java
import java.sql.*;

public class ResultSetExample {
    public static void main(String[] args) {
        try {
            // 1. Load driver and connect
            Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/testdb", "root", "password");

            // 2. Create and execute statement
            Statement stmt = con.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT id, name, salary FROM employees");

            // 3. Process ResultSet
            while (rs.next()) {
                int id = rs.getInt("id");
                String name = rs.getString("name");

                // Handling NULL value in salary
                int salary = rs.getInt("salary");
                if (rs.wasNull()) {
                    System.out.println("Salary is NULL for employee: " + name);
                } else {
                    System.out.println("ID: " + id + ", Name: " + name + ", Salary: " + salary);
                }
            }

            rs.close();
            stmt.close();
            con.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

---

#### ðŸ”¹ **Using `ResultSetMetaData`**

```java
ResultSetMetaData rsmd = rs.getMetaData();
int columnCount = rsmd.getColumnCount();

for (int i = 1; i <= columnCount; i++) {
    System.out.println("Column " + i + ": " + rsmd.getColumnName(i));
}
```

---

### âœ… **7. Transaction Management in JDBC**

#### ðŸ”¸ **Why Transactions?**

A transaction is a set of operations that should either **all succeed** or **all fail** to keep data consistent.

* Example: Transferring money from one account to another must debit and credit accounts **together**.

---

#### ðŸ”¹ **Transaction Methods**

| Method                     | Description                            |
| -------------------------- | -------------------------------------- |
| `con.setAutoCommit(false)` | Disable auto-commit for manual control |
| `con.commit()`             | Save changes permanently               |
| `con.rollback()`           | Undo all uncommitted changes           |
| `con.setSavepoint()`       | Create a savepoint (partial rollback)  |
| `con.rollback(savepoint)`  | Rollback to a specific point           |

---

#### ðŸ”¸ **Transaction Example:**

```java
import java.sql.*;

public class TransactionExample {
    public static void main(String[] args) {
        Connection con = null;

        try {
            con = DriverManager.getConnection("jdbc:mysql://localhost:3306/bank", "root", "password");

            // Disable auto-commit to start manual transaction
            con.setAutoCommit(false);

            // Transfer Rs. 1000 from Account A to B
            PreparedStatement ps1 = con.prepareStatement("UPDATE accounts SET balance = balance - 1000 WHERE acc_no = ?");
            ps1.setInt(1, 101);
            ps1.executeUpdate();

            PreparedStatement ps2 = con.prepareStatement("UPDATE accounts SET balance = balance + 1000 WHERE acc_no = ?");
            ps2.setInt(1, 102);
            ps2.executeUpdate();

            // If no error, commit transaction
            con.commit();
            System.out.println("Transaction successful!");

        } catch (Exception e) {
            try {
                if (con != null) {
                    con.rollback(); // Rollback on any error
                    System.out.println("Transaction failed. Rolled back.");
                }
            } catch (SQLException rollbackEx) {
                rollbackEx.printStackTrace();
            }
        } finally {
            try {
                if (con != null) con.close();
            } catch (SQLException closeEx) {
                closeEx.printStackTrace();
            }
        }
    }
}
```

---

#### ðŸ”¹ **Using Savepoints Example:**

```java
Savepoint sp1 = con.setSavepoint("BeforeSecondUpdate");

try {
    // 1st update
    ps1.executeUpdate();

    // 2nd update
    ps2.executeUpdate(); // Suppose this fails

    con.commit(); // Only happens if no error
} catch (Exception ex) {
    con.rollback(sp1); // Rollback to savepoint
    con.commit(); // Commit only the first update
}
```

---

### âœ… Summary

| Concept             | Key Point                                  |
| ------------------- | ------------------------------------------ |
| `ResultSet`         | Read query result row-by-row               |
| `ResultSetMetaData` | Get info like column names and types       |
| Handling NULL       | Use `rs.wasNull()` after `getInt()`, etc.  |
| Transactions        | Manual control using `commit`, `rollback`  |
| Savepoints          | Partial rollback to a point in transaction |

